{% load custom_filters %}

{% with info=row_data.contract_details %}

<a broadcaster ng-click='broadcasterCtrl.broadcast("openContractDetailsPopup", {setupUrl: "{% url debra.job_posts_views.campaign_create row_data.contract_id %}", signingContractOn: {% if row_data.signing_contract_on %}true{% else %}false{% endif %}, values: mailboxTableRow.contractDetailsColumn.values, storedValues: mailboxTableRow.contractDetailsColumn.storedValues, contractId: {{ row_data.contract_id }}, influencerId: {{ row_data.influencer_info.id }}, tab: 1, sendCollectDataUrl: "{% url debra.job_posts_views.send_collect_data_link row_data.contract_id %}", "downloadContractUrl": "{% url debra.job_posts_views.download_contract_document row_data.contract_id %}", "sendTrackingCodeUrl": "{% url debra.job_posts_views.send_tracking_code row_data.contract_id %}", "sendShipmentNotificationUrl": "{% url debra.job_posts_views.send_shipment_notification row_data.contract_id %}", "sendContractReminderUrl": "{% url debra.job_posts_views.send_collect_data_link row_data.contract_id %}", "sendFollowupMessageUrl": "{% url debra.job_posts_views.send_followup_message row_data.contract_id %}", "sendPostsAddingUrl": "{% url debra.job_posts_views.send_posts_adding_notification row_data.contract_id %}", "pipelineData": pipelineCtrl.data, "templateContextUrl": "{% url debra.job_posts_views.get_email_template_context row_data.contract_id %}", "bloggerPagePreviewUrl": "{{ row_data.tracking_code_link.blogger_form_preview_link }}"})' class="popup_link bs_tooltip" ng-class="{'contract_on': mailboxTableRow.contractDetailsColumn.values.signingContractOn}" data-placement="right" title="View Detailed Popup" tooltip></a>

{% verbatim %}
<div class="border_block"></div>

<a ng-if="mailboxTableRow.contractDetailsColumn.values.collectDetailsStatus.value == 0" class="popup_link popup_blogger_link bs_tooltip" data-placement="right" title="View Blogger's Page" a-href="{{ mailboxTableRow.contractDetailsColumn.values.bloggerPagePreviewUrl }}" tooltip ng-class="{'contract_on': mailboxTableRow.contractDetailsColumn.values.signingContractOn}"></a>
<a ng-if="mailboxTableRow.contractDetailsColumn.values.collectDetailsStatus.value > 0" class="popup_link popup_blogger_link bs_tooltip" data-placement="right" title="View Blogger's Page" a-href="{{ mailboxTableRow.contractDetailsColumn.values.bloggerPageUrl }}" tooltip ng-class="{'contract_on': mailboxTableRow.contractDetailsColumn.values.signingContractOn}"></a>

<a ng-if="mailboxTableRow.contractDetailsColumn.values.signingContractOn" class="popup_link popup_contract_view bs_tooltip" data-placement="right" title="View Contract" broadcaster ng-click="broadcasterCtrl.broadcast('openPdfDocumentPopup', {url: mailboxTableRow.contractDetailsColumn.values.contractStatus.value == 3 ? mailboxTableRow.contractDetailsColumn.values.downloadContractUrl : mailboxTableRow.contractDetailsColumn.values.contractPreviewUrl})" tooltip ng-class="{'contract_on': mailboxTableRow.contractDetailsColumn.values.signingContractOn}"></a>
{% endverbatim %}

<div propagate-cell-class="brand_not_sent_yet brand_pending brand_complete" ng-class="{'brand_not_sent_yet': mailboxTableRow.contractDetailsColumn.values.collectDetailsStatus.value == 0, 'brand_pending': mailboxTableRow.contractDetailsColumn.values.collectDetailsStatus.value == 1, 'brand_complete': mailboxTableRow.contractDetailsColumn.values.collectDetailsStatus.value == 2}">
    <div class="table_edit_boxes larger_box" mailbox-table-cell propagate-name="contractDetailsColumn">

        <div class="individual_brand_action" ng-class="{'brand_not_sent_yet': values.collectDetailsStatus.value == 0, 'brand_pending': values.collectDetailsStatus.value == 1, 'brand_complete': values.collectDetailsStatus.value == 2}">
            {% verbatim %}
            <span class="brand_action_label">Collect Details: </span>
            <span class="brand_action_status" >{{ values.collectDetailsStatus.name }}</span>&nbsp;
            {% endverbatim %}
        </div>


        <div class="individual_brand_action" ng-if="values.collectDetailsStatus.value == 0">
            <button class="mini_action_btn" broadcaster ng-click='broadcasterCtrl.broadcast("openSendEmailPopup", {url: "{% url debra.job_posts_views.send_collect_data_link row_data.contract_id %}", template: pipelineCtrl.data.info.collect_details_template.template, subject: pipelineCtrl.data.info.collect_details_template.subject, successCb: save, successCbParams: mailboxTableRow.contractDetailsColumn, status: values.collectDetailsStatus, templateContextUrl: "{% url debra.job_posts_views.get_email_template_context row_data.contract_id %}", bloggerPagePreviewUrl: "{{ row_data.tracking_code_link.blogger_form_preview_link }}", extraUrls: mailboxTableRow.contractDetailsColumn.values.signingContractOn ? [{type: "broadcast", name: "View Contract", eventName: "openPdfDocumentPopup", eventOptions: {url: mailboxTableRow.contractDetailsColumn.values.contractStatus.value == 3 ? mailboxTableRow.contractDetailsColumn.values.downloadContractUrl : mailboxTableRow.contractDetailsColumn.values.contractPreviewUrl}}] : null, successEvent: "refreshConversation", successEventParams: {mailboxId: {{ row_data.mailbox_id }}}})'>
                <span>Collect Details &amp; Contract</span>
            </button>
        </div>



        <div class="individual_brand_action" ng-class="{'brand_not_sent_yet': values.contractStatus.value == 0, 'brand_pending': values.contractStatus.value > 0 && values.contractStatus.value != 3, 'brand_complete': values.contractStatus.value == 3}" ng-if="values.collectDetailsStatus.value > 0">
            <div ng-if="pipelineCtrl.data.info.signing_contract_on">
                {% verbatim %}
                <span class="brand_action_label">Contract: </span>
                <span class="brand_action_status" >{{ values.contractStatus.name }}</span>&nbsp;
                {% endverbatim %}
            </div>
            <div class="mini_action_btn" broadcaster ng-click='broadcasterCtrl.broadcast("openSendEmailPopup", {url: "{% url debra.job_posts_views.send_collect_data_link row_data.contract_id %}", template: pipelineCtrl.data.info.collect_details_template.template, subject: pipelineCtrl.data.info.collect_details_template.subject, successCb: save, successCbParams: mailboxTableRow.contractDetailsColumn, status: values.collectDetailsStatus, templateContextUrl: "{% url debra.job_posts_views.get_email_template_context row_data.contract_id %}", bloggerPagePreviewUrl: "{{ row_data.tracking_code_link.blogger_form_preview_link }}", successEvent: "refreshConversation", successEventParams: {mailboxId: {{ row_data.mailbox_id }}}})' ng-if="values.collectDetailsStatus.value == 1">Send Reminder</div>

            <div class="mini_action_btn" broadcaster ng-click='broadcasterCtrl.broadcast("openSendEmailPopup", {url: "{% url debra.job_posts_views.send_collect_data_link row_data.contract_id %}", template: pipelineCtrl.data.info.collect_details_template.template, subject: pipelineCtrl.data.info.collect_details_template.subject, successCb: save, successCbParams: mailboxTableRow.contractDetailsColumn, status: values.contractStatus, templateContextUrl: "{% url debra.job_posts_views.get_email_template_context row_data.contract_id %}", successEvent: "refreshConversation", successEventParams: {mailboxId: {{ row_data.mailbox_id }}}})' ng-if="pipelineCtrl.data.info.signing_contract_on && values.contractStatus.value > 0 && values.contractStatus.value != 3 && values.collectDetailsStatus.value == 2">Send Reminder</div>

            <div ng-if="pipelineCtrl.data.info.signing_contract_on && values.contractStatus.value == 3" broadcaster ng-click="broadcasterCtrl.broadcast('openPdfDocumentPopup', {url: '{% url debra.job_posts_views.download_contract_document row_data.contract_id %}'})" class="mini_action_btn">View Contract</div>
        </div>



        <div post-analytics-update class="edit_field_in_table" target-url="{% url debra.job_posts_views.edit_contract row_data.contract_id %}" values-list='{"hashtagsRequired": "{{ row_data.global_details.hashtags_required|default_if_none:''|escapejs }}", "mentionsRequired": "{{ row_data.global_details.mentions_required|default_if_none:''|escapejs }}", "campaignName": "{{ row_data.global_details.campaign_name|default_if_none:''|escapejs }}", "clientUrl": "{{ row_data.global_details.client_url|default_if_none:''|escapejs }}", "clientName": "{{ row_data.global_details.client_name|default_if_none:''|escapejs }}", "deliverables": {{ row_data.deliverables.deliverables|jsonify }}, "dateRange": {"startDate": "{{ row_data.date_range.start_date|date:"Y-m-d" }}", "endDate": "{{ row_data.date_range.latest_date|date:"Y-m-d" }}"}, "requirements": "{{ row_data.post_requirements.post_requirements|default_if_none:''|escapejs }}", "finalRate": {{ row_data.final_rate.final_rate }}, "influencerName": "{{ row_data.influencer_info.name|default_if_none:''|escapejs }}", "blogName": "{{ row_data.influencer_info.blogname|default_if_none:''|escapejs }}", "entityName": "{{ row_data.paypal.entity_name|default_if_none:''|escapejs }}", "paymentDetails": "{{ row_data.paypal.username|default_if_none:''|escapejs }}", "paymentDetailsOn": {% if row_data.paypal.payment_details_on %}true{% else %}false{% endif %}, "restrictions": "{{ row_data.restrictions.restrictions|default_if_none:''|escapejs }}", "productUrl":  "{{ row_data.product_url.product_url|default_if_none:''|escapejs }}", "productUrls": {{ row_data.product_url.product_urls|jsonify }}, "shippingAddress": "{{ row_data.address.address|default_if_none:''|escapejs }}", "productPreferences": "{{ row_data.product_details.details|default_if_none:''|escapejs }}", "shipDate": {% if row_data.ship_date.ship_date %}"{{ row_data.ship_date.ship_date|date:"Y-m-d" }}"{% else %}null{% endif %}, "shipmentTrackingCode": "{{ row_data.shipment_tracking_code.shipment_tracking_code|default_if_none:''|escapejs }}", "dateRequirements": "{{ row_data.date_requirements.date|date:"Y-m-d" }}", "postLinks": {{ row_data.post_links.links|jsonify }}, "trackingPageUrl": "{{ row_data.tracking_code_link.tracking_code_link|default_if_none:''|escapejs }}", "postApprovalPageUrl": "{{ row_data.tracking_code_link.post_approval_link|default_if_none:''|escapejs }}", "bloggerPostsPageUrl": "{{ row_data.tracking_code_link.blogger_posts_link|default_if_none:''|escapejs }}", "bloggerPageUrl": "{{ row_data.tracking_code_link.blogger_page_link|default_if_none:''|escapejs }}", "bloggerShipmentUrl": "{{ row_data.tracking_code_link.blogger_shipment_link|default_if_none:''|escapejs }}", "rating": {{ row_data.rating.rating }}, "reviews": "{{ row_data.reviews.reviews|default_if_none:''|escapejs }}",  "collectDetailsStatus": {{ row_data.collect_details.status|jsonify }}, "contractStatus": {{ row_data.contract_actions.contract_status|jsonify }}, "trackingStatus": {{ row_data.contract_actions.tracking_status|jsonify }}, "postApprovalStatus": {{ row_data.contract_actions.post_approval_status|jsonify }}, "postsAddingStatus": {{ row_data.contract_actions.posts_adding_status|jsonify }}, "shipmentStatus": {{ row_data.contract_actions.shipment_status|jsonify }}, "shipmentReceivedDate": "{{ row_data.shipment_received_date|date:"Y-m-d" }}", "displayedRate": "{{ row_data.displayed_rate.displayed_rate|default_if_none:''|escapejs }}", "agentName": "{{ row_data.paypal.agent_name|default_if_none:''|escapejs }}", "paymentTerms": "{{ row_data.paypal.payment_terms|default_if_none:''|escapejs }}", "phoneNumber": "{{ row_data.paypal.phone_number|default_if_none:''|escapejs }}", "contractPreviewUrl": "{% url debra.job_posts_views.download_contract_document_preview row_data.contract_id %}", "bloggerPagePreviewUrl": "{{ row_data.tracking_code_link.blogger_form_preview_link }}", "signingContractOn": {% if row_data.signing_contract_on %}true{% else %}false{% endif %}, "downloadContractUrl": "{% url debra.job_posts_views.download_contract_document row_data.contract_id %}"}'>
        </div>

    </div>
</div>
{% endwith %}
